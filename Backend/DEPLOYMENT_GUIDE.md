# 🚀 Tuinue Wasichana - Render Deployment Guide

This guide will help you deploy your Tuinue Wasichana API to Render with automatic admin user creation.

## 📋 Pre-Deployment Checklist

### 1. Environment Variables Setup
Make sure these environment variables are configured in your Render dashboard:

#### Required Variables:
- `FLASK_ENV=production`
- `FLASK_APP=app.py`
- `DATABASE_URL` (auto-generated by Render)
- `SECRET_KEY` (auto-generated by Render)
- `JWT_SECRET_KEY` (auto-generated by Render)

#### Admin User Variables:
- `CREATE_ADMIN_ON_DEPLOY=true`
- `ADMIN_NAME=Tuinue Wasichana Admin`
- `ADMIN_EMAIL=admin@tuinuewasichana.org`
- `ADMIN_PASSWORD=TuinueAdmin2024!`

#### Optional Variables:
- `REDIS_URL` (if using Redis)
- `CELERY_BROKER_URL` (if using Celery)
- `CELERY_RESULT_BACKEND` (if using Celery)

### 2. Files Required
Ensure these files are in your repository:
- ✅ `Backend/render.yaml` - Render configuration
- ✅ `Backend/deploy.py` - Deployment script
- ✅ `Backend/requirements.txt` - Python dependencies
- ✅ `Backend/app.py` - Flask application
- ✅ `.gitignore` - Git ignore rules

## 🔧 Deployment Steps

### Step 1: Connect Repository to Render

1. **Login to Render Dashboard**
   - Go to [render.com](https://render.com)
   - Sign in with your GitHub account

2. **Create New Web Service**
   - Click "New +" → "Web Service"
   - Connect your GitHub repository
   - Select the repository containing your code

3. **Configure Service**
   - **Name:** `tuinue-wasichana-api`
   - **Environment:** `Python`
   - **Build Command:** `pip install -r requirements.txt && python deploy.py`
   - **Start Command:** `gunicorn --bind 0.0.0.0:$PORT app:app`
   - **Root Directory:** `Backend` (if your Flask app is in Backend folder)

### Step 2: Set Environment Variables

In your Render service dashboard, add these environment variables:

```bash
# Flask Configuration
FLASK_ENV=production
FLASK_APP=app.py

# Security Keys (let Render generate these)
SECRET_KEY=[Generate Value]
JWT_SECRET_KEY=[Generate Value]

# Admin User Configuration
CREATE_ADMIN_ON_DEPLOY=true
ADMIN_NAME=Tuinue Wasichana Admin
ADMIN_EMAIL=admin@tuinuewasichana.org
ADMIN_PASSWORD=TuinueAdmin2024!

# Database (will be auto-configured if using Render PostgreSQL)
DATABASE_URL=[From Database Service]
```

### Step 3: Create Database Service

1. **Create PostgreSQL Database**
   - In Render dashboard: "New +" → "PostgreSQL"
   - **Name:** `tuinue-wasichana-db`
   - **Database Name:** `tuinue_wasichana`
   - **User:** `tuinue_user`

2. **Link Database to Web Service**
   - The `DATABASE_URL` will be automatically provided
   - Your web service will have access to the database

### Step 4: Deploy

1. **Trigger Deployment**
   - Push your code to GitHub
   - Render will automatically deploy
   - Monitor the build logs

2. **Verify Deployment**
   - Check build logs for success messages
   - Look for: "🎉 DEPLOYMENT COMPLETED SUCCESSFULLY!"
   - Verify admin user creation logs

## 🔍 Deployment Logs to Look For

### Successful Deployment Logs:
```
🚀 Starting Tuinue Wasichana API deployment...
📦 Loading application...
🗄️  Initializing database...
📋 Creating database tables...
✅ Database tables created successfully
🔄 Running database migrations...
✅ Database migrations completed successfully
🔍 Checking for admin user: admin@tuinuewasichana.org
👤 Creating admin user: admin@tuinuewasichana.org
✅ Admin user created successfully!
   📧 Email: admin@tuinuewasichana.org
   👤 Name: Tuinue Wasichana Admin
   🔑 Role: admin

==================================================
🎉 DEPLOYMENT COMPLETED SUCCESSFULLY!
==================================================
🌐 API URL: https://tuinue-wasichana-api-amem.onrender.com
👤 Admin Email: admin@tuinuewasichana.org
🔐 Admin Password: **************
📱 Frontend: Connect your React app to this API
🔧 Admin Dashboard: Login with admin credentials
==================================================
```

## 🧪 Testing Your Deployment

### 1. Test API Health
```bash
curl https://your-app-name.onrender.com/health
```
Expected response:
```json
{
  "status": "healthy",
  "service": "tuinue-wasichana-api"
}
```

### 2. Test Admin Login
1. Go to your frontend application
2. Login with:
   - **Email:** `admin@tuinuewasichana.org`
   - **Password:** `TuinueAdmin2024!`
3. Verify you're redirected to `/admin` dashboard
4. Check that you can see charity applications

### 3. Test Charity Application Flow
1. Register as a donor
2. Apply as a charity
3. Login as admin
4. Approve/reject the application

## 🔒 Security Considerations

### Production Security:
1. **Change Default Admin Password**
   - Update `ADMIN_PASSWORD` environment variable
   - Use a strong, unique password

2. **Secure Environment Variables**
   - Never commit `.env` files to Git
   - Use Render's environment variable management
   - Rotate secrets regularly

3. **Database Security**
   - Use Render's managed PostgreSQL
   - Enable SSL connections
   - Regular backups are automatic

## 🚨 Troubleshooting

### Common Issues:

#### 1. Build Fails
- **Check:** `requirements.txt` has all dependencies
- **Check:** Python version compatibility
- **Check:** Build command is correct

#### 2. Admin User Not Created
- **Check:** `CREATE_ADMIN_ON_DEPLOY=true` is set
- **Check:** All admin environment variables are set
- **Check:** Database connection is working

#### 3. Database Connection Issues
- **Check:** `DATABASE_URL` is properly set
- **Check:** Database service is running
- **Check:** Network connectivity

#### 4. Frontend Can't Connect
- **Check:** API URL is correct in frontend
- **Check:** CORS is properly configured
- **Check:** API is responding to health checks

### Debug Commands:
```bash
# Check environment variables
echo $DATABASE_URL
echo $ADMIN_EMAIL

# Test database connection
python -c "from app import create_app; app = create_app(); print('App created successfully')"

# List users in database
python -c "from app import create_app; from app.models.user import User; app = create_app(); app.app_context().push(); users = User.query.all(); print([u.email for u in users])"
```

## 📞 Support

If you encounter issues:
1. Check Render build logs
2. Verify environment variables
3. Test API endpoints manually
4. Check database connectivity

## 🎉 Success!

Once deployed successfully, you'll have:
- ✅ API running on Render
- ✅ PostgreSQL database
- ✅ Admin user automatically created
- ✅ Ready for frontend integration
- ✅ Charity application system functional

Your admin credentials:
- **Email:** `admin@tuinuewasichana.org`
- **Password:** `TuinueAdmin2024!`

**Remember to change the default password in production!**